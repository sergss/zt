/**
 * ============================================================================
 * ИНСТРУКЦИЯ ПО СОЗДАНИЮ УРОВНЕЙ (LEVEL DESIGN GUIDE)
 * ============================================================================
 * 
 * Данный файл содержит класс `LevelManager`, который управляет списком всех
 * уровней в игре. Каждый уровень описывается объектом, возвращаемым функцией
 * (например, `createLevel1()`).
 * 
 * Структура объекта уровня:
 * {
 *    map: [[]],          // Двумерный массив карты уровня (сетка ячеек)
 *    playerStart: {},    // Стартовая позиция игрока
 *    enemies: [],        // Список врагов на уровне
 *    items: []           // Список подбираемых предметов на уровне
 * }
 * 
 * 1. КАРТА УРОВНЯ (map)
 * ----------------------------------------------------------------------------
 * Карта представляет собой двумерный массив чисел. Размер может быть любым,
 * но для тестов сейчас используется 20x20.
 *
 * Значения ячеек карты (ID блоков):
 *   0  = Пустое пространство (пол) — игрок и враги могут ходить.
 *   1  = Глухой металл (metal) — непроходимая базовая стена (внешние границы).
 *   2  = Кирпичная кладка (bricks) — непроходимая стена.
 *   3  = Техническая панель (tech) — непроходимая стена (компьютеры, провода).
 *   4  = Бетон (concrete) — непроходимая стена.
 *   5  = Непроходимая стена типа "дверь" (door).
 *   8  = ЛИФТ (elevator) — специальный блок окончания уровня. Игрок сможет 
 *        через него пройти и завершить уровень ТОЛЬКО когда убиты все враги.
 *   9  = ИНТЕРАКТИВНАЯ ДВЕРЬ - открывается кнопкой "Взаимодействие" (выстрел
 *        вплотную, если нет патронов или выстрел из оружия).
 *
 * ВАЖНО: Карта всегда должна быть обнесена глухими стенами (например, 1) по
 * периметру, чтобы игрок не провалился в пустоту (out of bounds).
 *
 * 2. СТАРТОВАЯ ПОЗИЦИЯ ИГРОКА (playerStart)
 * ----------------------------------------------------------------------------
 * playerStart: { x: 2.5, y: 2.5, angle: 0 }
 *   - `x` и `y`: координаты на карте. .5 означает, что игрок стоит ровно
 *     в центре игровой ячейки [2, 2].
 *   - `angle`: направление взгляда в радианах. 
 *     0 = вправо, Math.PI / 2 = вниз, Math.PI = влево, -Math.PI / 2 = вверх.
 *
 * 3. ВРАГИ (enemies)
 * ----------------------------------------------------------------------------
 * enemies: [ { type: 'soldier', x: 8.5, y: 7.5 }, ... ]
 *   - `type`: тип врага (строка). Доступны: 'soldier', 'guard', 'zombie', 'alien'.
 *     (Характеристики и спрайты этих типов описаны в `enemy.js`).
 *   - `x` и `y`: дробные центрированные координаты старта врага на пустом месте (0).
 *
 * ВАЖНО: Лифт не заработает, пока длина списка активных врагов (чей HP > 0) 
 * не станет равна 0. Обязательно добавляйте врагов, иначе лифт будет сразу открыт.
 * 
 * 4. ПРЕДМЕТЫ (items)
 * ----------------------------------------------------------------------------
 * items: [ { type: 'health_pack', x: 4.5, y: 4.5 }, ... ]
 *   - Описываются аналогично врагам. Спрайт исчезает и даёт бонус,
 *     когда расстояние между игроком и предметом становится меньше 0.5.
 *
 * Доступные типы предметов:
 *   -- Аптечки и броня --
 *   'healthBig' / 'medkit'    (Крупная аптечка)
 *   'healthSmall' / 'health_pack' (Малая аптечка)
 *   'armor'                   (Броня)
 *   'key'                     (Ключ-карта)
 *
 *   -- Оружие (открывает слот) --
 *   'weaponShotgun', 'weaponAssaultRifle', 'weaponMachinegun', 
 *   'weaponRocketLauncher', 'weaponFlamethrower', 'weaponLaser'
 *
 *   -- Патроны --
 *   'ammoBullets', 'ammoShells', 'ammoBelt', 'ammoRockets', 'ammoFuel', 'ammoCells'
 * 
 * При добавлении нового уровня:
 * 1. Создайте метод `createLevelX()` по аналогии с `createLevel1()`.
 * 2. Поместите результаты вызова нового метода в массив `this.levels`
 *    внутри конструктора `LevelManager`.
 * ============================================================================
 */

class LevelManager {
    constructor() {
        this.currentLevel = 0;

        // Define 3 test levels
        this.levels = [
            this.createLevel1(),
            this.createLevel2(),
            this.createLevel3()
        ];

        this.enemiesLeft = 0;
    }

    setEnemiesLeft(count) {
        this.enemiesLeft = count;
    }

    isElevatorActive() {
        return this.enemiesLeft === 0;
    }

    nextLevel() {
        if (this.currentLevel < this.levels.length - 1) {
            this.currentLevel++;
            return true; // Successfully advanced
        }
        return false; // No more levels
    }

    getCurrentLevelData() {
        if (this.currentLevel >= 0 && this.currentLevel < this.levels.length) {
            return this.levels[this.currentLevel];
        }
        return null;
    }

    // --- Level definitions ---

    createLevel1() {
        // Simple map
        const mapData = [
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 8, 1],
            [1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 0, 1],
            [1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 0, 2, 2, 0, 1, 0, 1, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1],
            [1, 0, 1, 0, 2, 2, 0, 1, 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1],
            [1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1],
            [1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1],
            [1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1],
            [1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1],
            [1, 0, 1, 0, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 1],
            [1, 0, 1, 0, 1, 0, 1, 0, 1, 1, 1, 1, 0, 1, 0, 1, 0, 1, 0, 1],
            [1, 0, 1, 0, 1, 0, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        ];
        return {
            map: mapData,
            playerStart: { x: 1.5, y: 1.5, angle: 0 },
            enemies: [
                { type: 'soldier', x: 8.5, y: 7.5 },
                { type: 'zombie', x: 18.5, y: 5.5 },
                { type: 'guard', x: 10.5, y: 15.5 }
            ],
            items: [
                { type: 'health_pack', x: 6.5, y: 4.5 },
                { type: 'ammo_bullets', x: 6.5, y: 5.5 }
            ]
        };
    }

    createLevel2() {
        const mapData = [
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 2, 2, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 2, 2, 0, 1],
            [1, 0, 2, 2, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 2, 2, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 1, 0, 1, 1, 0, 1, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 8, 1],
            [1, 0, 1, 1, 0, 1, 0, 1, 0, 0, 0, 0, 1, 0, 1, 0, 1, 1, 1, 1],
            [1, 0, 1, 1, 0, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1],
            [1, 0, 4, 4, 4, 4, 0, 3, 3, 3, 3, 0, 2, 2, 2, 0, 0, 0, 0, 1],
            [1, 0, 4, 0, 0, 4, 0, 3, 0, 0, 3, 0, 2, 0, 2, 0, 1, 1, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        ];
        return {
            map: mapData,
            playerStart: { x: 2.5, y: 18.5, angle: -Math.PI / 2 },
            enemies: [
                { type: 'soldier', x: 3.5, y: 13.5 },
                { type: 'alien', x: 14.5, y: 18.5 },
                { type: 'guard', x: 8.5, y: 8.5 },
                { type: 'zombie', x: 18.5, y: 4.5 }
            ],
            items: [
                { type: 'weapon_shotgun', x: 3.5, y: 17.5 },
                { type: 'health_pack', x: 1.5, y: 1.5 }
            ]
        };
    }

    createLevel3() {
        const mapData = [
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1],
            [1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 0, 1, 1, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 2, 2, 2, 2, 0, 3, 3, 3, 3, 3, 3, 0, 2, 2, 2, 2, 0, 1],
            [1, 0, 2, 0, 0, 2, 0, 0, 0, 0, 0, 0, 0, 0, 2, 0, 0, 2, 0, 1],
            [1, 0, 2, 0, 0, 2, 0, 1, 1, 1, 1, 1, 1, 0, 2, 0, 0, 2, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 1, 8, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 3, 3, 0, 4, 4, 4, 4, 4, 4, 4, 4, 4, 4, 0, 3, 3, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1, 1, 1, 1, 0, 1, 1, 1, 1, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 0, 1, 1, 1, 1, 1, 1, 0, 1, 1, 0, 1, 1, 1, 1, 1, 1, 0, 1],
            [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
            [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]
        ];
        return {
            map: mapData,
            playerStart: { x: 18.5, y: 18.5, angle: Math.PI }, // Bottom right
            enemies: [
                { type: 'alien', x: 1.5, y: 2.5 }, // Boss room guys
                { type: 'alien', x: 18.5, y: 2.5 },
                { type: 'guard', x: 10.5, y: 14.5 },
                { type: 'soldier', x: 10.5, y: 6.5 },
                { type: 'zombie', x: 5.5, y: 10.5 },
                { type: 'zombie', x: 15.5, y: 10.5 }
            ],
            items: [
                { type: 'weapon_rocket', x: 11.5, y: 16.5 },
                { type: 'health_pack', x: 1.5, y: 16.5 },
                { type: 'armor', x: 17.5, y: 16.5 }
            ]
        };
    }
}
